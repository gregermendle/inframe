<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@500&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: Inter, sans;
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>

  <body>
    <canvas id="frame" width="578" height="578"></canvas>
    <input id="frame-text" />
    <input id="color" type="color" value="rgb(69, 30, 100)" />
    <script>
      let inter = new FontFace(
        "Inter",
        "url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYAZ9hiA.woff2)"
      );

      let image = new Image();
      image.src =
        "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTKqAPhtu1u5tDwBglj_KWyUOyKg-PBGbTWdKWn1nvbeqxzjz7aVrVuuvjzBCCB-_lf5oU&usqp=CAU";

      let frameTextInput = document.getElementById("frame-text");
      let canvas = document.getElementById("frame");
      let context = canvas.getContext("2d");

      function draw(str) {
        let len = str.length;
        let s;

        context.reset();
        let centerX = canvas.width / 2;
        let centerY = canvas.height / 2;
        let radius = 150;

        // draw circle underneath text
        context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
        context.clip();
        context.drawImage(
          image,
          centerX - radius,
          centerY - radius,
          2 * radius,
          2 * radius
        );
        context.save();

        context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);

        // Create a radial gradient
        // The inner circle is at x=110, y=90, with radius=30
        // The outer circle is at x=100, y=100, with radius=70
        const gradient = context.createRadialGradient(
          centerX - radius,
          centerY + radius,
          radius,
          centerX + radius / 2,
          centerY - radius,
          radius + radius / 3
        );

        // Add three color stops
        gradient.addColorStop(0.9, "rgba(69, 30, 100, 1.0)");
        gradient.addColorStop(1, "rgba(69, 30, 100, 0.2)");

        // Set the fill style and draw a rectangle
        context.strokeStyle = gradient;
        context.lineWidth = 90;
        context.stroke();
        context.save();

        context.font = "24px Inter";
        context.textAlign = "center";
        context.fillStyle = "white";

        let strWidth = context.measureText(str).width;
        let angle = Math.PI * (strWidth / (2 * radius));

        context.save();
        context.translate(centerX, centerY);
        context.rotate((angle + (60 * Math.PI) / 180) / 2);

        for (var n = 0; n < len; n++) {
          s = str[n];
          context.rotate(-1 * (angle / len));
          context.save();
          context.translate(0, radius - 15);
          context.fillText(s, 0, 0);
          context.restore();
        }
        context.restore();
      }
      image.onload = () => {
        inter.load().then((font) => {
          document.fonts.add(font);
          requestAnimationFrame(() => {
            draw("#BACKANDBODYHURTS");
          });
        });
      };

      let request;
      frameTextInput.addEventListener("input", (e) => {
        cancelAnimationFrame(request);
        request = requestAnimationFrame(() => {
          draw(e.target.value.toUpperCase());
        });
      });
    </script>
  </body>
</html>
